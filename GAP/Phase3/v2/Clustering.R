# --------------------------------------------------------------------------------------------------------------
# --------------------------------------------------------------------------------------------------------------
# --------------------------------------------------------------------------------------------------------------
#                                       ||     Bounce Rate    ||
# --------------------------------------------------------------------------------------------------------------
# --------------------------------------------------------------------------------------------------------------

Bounce_Rate_Raw <- read.table("C:/Yashwanth/Clustering/Bounce_rate.csv", 
                header = TRUE, sep = ",", quote = "\"", dec = "." ,fill=TRUE, comment.char="", as.is=TRUE)
colnames(Bounce_Rate_Raw)[1] <- "Pages"

Bounce_Rate_Raw_T <-read.table("C:/Yashwanth/Clustering/Bounce_Trans.csv",
                          header = TRUE, sep = ",", quote = "\"", dec = "." ,fill=TRUE, comment.char="", as.is=TRUE)

library(clusterSim)
Bounce_Rate_Std <- data.Normalization(Bounce_Rate_Raw,type="n1")

# --------------------------------------------------------------------------------------------------------------
# --------------------------------------------------------------------------------------------------------------
#                                       || Transpose data  ||
# --------------------------------------------------------------------------------------------------------------
# --------------------------------------------------------------------------------------------------------------

Bounce_Rate <- data.frame(t(Bounce_Rate_Raw))
rownames(Bounce_Rate)[1] <- "Weeks"
Demo <- Bounce_Rate_Raw[1:10,1:5]
Demo <- cbind(Weeks=rownames(Demo),Demo)
rownames(Demo) <- NULL
#rm(list=ls())

# --------------------------------------------------------------------------------------------------------------
# --------------------------------------------------------------------------------------------------------------
#                                       || Moving Averages  ||
# --------------------------------------------------------------------------------------------------------------
# --------------------------------------------------------------------------------------------------------------

Bounce_Rate_MA <- Bounce_Rate_Raw
for(i in c(2:ncol(Bounce_Rate_Raw))){
  Bounce_Rate_MA[i] <- NA
  Bounce_Rate_MA[i] <- SMA(Bounce_Rate_Raw[,i],n=10)
}

Bounce_Rate_New <- data.frame(Bounce_Rate_Raw[,1],Bounce_Rate_MA)
names(Bounce_Rate_New) <- c("Pages","Bounce_Rate")
Bounce_Rate_New$Bounce_Rate_Raw[is.na(Bounce_Rate_New$Bounce_Rate_Raw)] <- mean(Bounce_Rate_New$Bounce_Rate_Raw,na.rm=T)

# --------------------------------------------------------------------------------------------------------------
# --------------------------------------------------------------------------------------------------------------

# --------------------------------------------------------------------------------------------------------------
# --------------------------------------------------------------------------------------------------------------
#                                       ||     Average Time on Page    ||
# --------------------------------------------------------------------------------------------------------------
# --------------------------------------------------------------------------------------------------------------

Avg_Time_On_Page <- read.table("C:/Yashwanth/Clustering/AvgTimeOnPage.csv", 
                          header = TRUE, sep = ",", quote = "\"", dec = "." ,fill=TRUE, comment.char="", as.is=TRUE)

Avg_Time_On_Page_T <- data.frame(t(Avg_Time_On_Page))
  
Avg_Time_On_Page_T <- read.table("C:/Yashwanth/Clustering/Avg_Time_On_Page_T.csv", 
                        header = TRUE, sep = ",", quote = "\"", dec = "." ,fill=TRUE, comment.char="", as.is=TRUE)

Avg_Time_On_Page_Std <- data.Normalization(Avg_Time_On_Page,type="n1")

# --------------------------------------------------------------------------------------------------------------
# --------------------------------------------------------------------------------------------------------------
#                                       || Moving Averages  ||
# --------------------------------------------------------------------------------------------------------------
# --------------------------------------------------------------------------------------------------------------

Avg_Time_On_Page_MA <- SMA(Avg_Time_On_Page[,c(2:ncol(Avg_Time_On_Page))],n=10)
Avg_Time_On_Page_New <- data.frame(Avg_Time_On_Page[,1],Avg_Time_On_Page_MA)
names(Avg_Time_On_Page_New) <- c("Pages","Avg_Time_On_Page")
Avg_Time_On_Page_New$Avg_Time_On_Page[is.na(Avg_Time_On_Page_New$Avg_Time_On_Page)] <- mean(Avg_Time_On_Page_New$Avg_Time_On_Page,na.rm=T)

# --------------------------------------------------------------------------------------------------------------
# --------------------------------------------------------------------------------------------------------------
#                                       ||     Visits    ||
# --------------------------------------------------------------------------------------------------------------
# --------------------------------------------------------------------------------------------------------------

Visits <- read.table("C:/Yashwanth/Clustering/Visits.csv", 
                          header = TRUE, sep = ",", quote = "\"", dec = "." ,fill=TRUE, comment.char="", as.is=TRUE)
Visits_T <- data.frame(t(Visits))

Visits_T <- read.table("C:/Yashwanth/Clustering/Visits_T.csv", 
                          header = TRUE, sep = ",", quote = "\"", dec = "." ,fill=TRUE, comment.char="", as.is=TRUE)

Visits_Std <- data.Normalization(Visits,type="n1")

# --------------------------------------------------------------------------------------------------------------
# --------------------------------------------------------------------------------------------------------------
#                                       || Moving Averages  ||
# --------------------------------------------------------------------------------------------------------------
# --------------------------------------------------------------------------------------------------------------

Visits_MA <- SMA(Visits[,c(2:ncol(Visits))],n=10)
Visits_New <- data.frame(Visits[,1],Visits_MA)
names(Visits_New) <- c("Pages","Visits")
Visits_New$Visits[is.na(Visits_New$Visits)] <- mean(Visits_New$Visits,na.rm=T)

# --------------------------------------------------------------------------------------------------------------
# --------------------------------------------------------------------------------------------------------------
#                                       ||     Product Page Views    ||
# --------------------------------------------------------------------------------------------------------------
# --------------------------------------------------------------------------------------------------------------

Prod_Page_Views <- read.table("C:/Yashwanth/Clustering/ProductPageViews.csv", 
                          header = TRUE, sep = ",", quote = "\"", dec = "." ,fill=TRUE, comment.char="", as.is=TRUE)

Prod_Page_Views_T <- data.frame(t(Prod_Page_Views))

Prod_Page_Views_T <- read.table("C:/Yashwanth/Clustering/Prod_Page_Views_T.csv", 
                       header = TRUE, sep = ",", quote = "\"", dec = "." ,fill=TRUE, comment.char="", as.is=TRUE)

Prod_Page_Views_Std <- data.Normalization(Visits,type="n1")

# --------------------------------------------------------------------------------------------------------------
# --------------------------------------------------------------------------------------------------------------
#                                       || Moving Averages  ||
# --------------------------------------------------------------------------------------------------------------
# --------------------------------------------------------------------------------------------------------------

Prod_Page_Views_MA <- SMA(Prod_Page_Views[,c(2:ncol(Prod_Page_Views))],n=10)
Prod_Page_Views_New <- data.frame(Prod_Page_Views[,1],Prod_Page_Views_MA)
names(Prod_Page_Views_New) <- c("Pages","Prod_Page_Views")
Prod_Page_Views_New$Prod_Page_Views[is.na(Prod_Page_Views_New$Prod_Page_Views)] <- mean(Prod_Page_Views_New$Prod_Page_Views,na.rm=T)

# --------------------------------------------------------------------------------------------------------------
# --------------------------------------------------------------------------------------------------------------
#                                       || Combine all Variables  ||
# --------------------------------------------------------------------------------------------------------------
# --------------------------------------------------------------------------------------------------------------

Final_Cluster_data <- cbind(Bounce_Rate_New,Avg_Time_On_Page_New[,2],Visits_New[,2],Prod_Page_Views_New[,2])
colnames(Final_Cluster_data) <- c("Pages","Bounce_Cluster","Avg_Time_On_Page","Visits","Prod_Page_Views")

# --------------------------------------------------------------------------------------------------------------
# --------------------------------------------------------------------------------------------------------------
#                                       || K-means Clustering ||
# --------------------------------------------------------------------------------------------------------------
# --------------------------------------------------------------------------------------------------------------

fit_Kmeans <- kmeans(Final_Cluster_data[,2:5],3)
Cluster_Tab <- data.frame(Final_Cluster_data[,1],fit_Kmeans$cluster)
names(Cluster_Tab) <- c("Pages","Clusters")
Cluster_Tab <- data.frame(with(Cluster_Tab,Cluster_Tab[order(Clusters),]),row.names=NULL)


# --------------------------------------------------------------------------------------------------------------
# --------------------------------------------------------------------------------------------------------------
# --------------------------------------------------------------------------------------------------------------
# --------------------------------------------------------------------------------------------------------------
# --------------------------------------------------------------------------------------------------------------
# --------------------------------------------------------------------------------------------------------------
# --------------------------------------------------------------------------------------------------------------
# --------------------------------------------------------------------------------------------------------------
